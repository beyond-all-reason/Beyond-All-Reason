
#include "../recoil_common_includes.h"

#define SIGNAL_BUILD 2
#define SIGNAL_MOVE 1

piece  pelvis, lthigh, rthigh, torso, rleg, rfoot, lleg, lfoot,
       luparm, ruparm, rnano, lnano, aimx1, aimy1, armhexl, armhexl2, armhexl_emit, armhexl2_emit;

static-var  isMoving, nanoNozzle, animSpeed, maxSpeed, animFramesPerKeyframe;
			
Walk() {//Created by https://github.com/Beherith/Skeletor_S3O from C:\Users\ptasz\Dropbox\BAR\Remoddeling\Reanimating\fark.blend 
	if (isMoving) { //Frame:3
			turn lfoot to x-axis <-37.751326> speed <1132.539710> / animSpeed; 
			turn lfoot to y-axis <-1.118689> speed <33.560655> / animSpeed; 
			move lleg to z-axis [0.948327] speed [28.449823] / animSpeed; 
			move lleg to y-axis [-0.663851] speed [19.915534] / animSpeed; 
			turn lthigh to x-axis <35.365845> speed <1060.975358> / animSpeed; 
			turn luparm to x-axis <42.886368> speed <65.416649> / animSpeed; 
			turn luparm to z-axis <0.302246> speed <9.067391> / animSpeed; 
			turn luparm to y-axis <-0.155167> speed <4.655000> / animSpeed; 
			move pelvis to y-axis [0.300000] speed [9.0] / animSpeed; 
			turn rfoot to x-axis <6.399191> speed <191.975799> / animSpeed; 
			turn rfoot to z-axis <0.378272> speed <11.348151> / animSpeed; 
			move rleg to z-axis [0.542942] speed [16.288252] / animSpeed; 
			move rleg to y-axis [-0.485064] speed [14.551928] / animSpeed; 
			turn rthigh to x-axis <-29.161643> speed <874.849288> / animSpeed; 
			turn torso to y-axis <-3.333333> speed <100.0> / animSpeed; 
		sleep 65;
	}
	while(isMoving) {
		if (isMoving) { //Frame:5
			turn lfoot to x-axis <-31.372876> speed <191.353521> / animSpeed; 
			turn lfoot to z-axis <0.713240> speed <22.515296> / animSpeed; 
			turn lfoot to y-axis <2.407080> speed <105.773059> / animSpeed; 
			move lleg to z-axis [0.566217] speed [11.463327] / animSpeed; 
			move lleg to y-axis [-0.536047] speed [3.834136] / animSpeed; 
			turn lthigh to x-axis <65.546143> speed <905.408920> / animSpeed; 
			turn luparm to x-axis <36.829555> speed <181.704410> / animSpeed; 
			turn luparm to z-axis <0.453370> speed <4.533696> / animSpeed; 
			move pelvis to y-axis [-0.100000] speed [12.0] / animSpeed; 
			turn pelvis to x-axis <1.555287> speed <46.658604> / animSpeed; 
			turn pelvis to y-axis <3.500000> speed <105.0> / animSpeed; 
			turn rfoot to x-axis <12.576867> speed <185.330293> / animSpeed; 
			turn rfoot to z-axis <0.776968> speed <11.960897> / animSpeed; 
			turn rfoot to y-axis <-1.710736> speed <53.084530> / animSpeed; 
			move rleg to z-axis [0.0] speed [16.288252] / animSpeed; 
			move rleg to y-axis [0.0] speed [14.551928] / animSpeed; 
			turn rthigh to x-axis <-14.200525> speed <448.833536> / animSpeed; 
			turn ruparm to x-axis <54.348355> speed <278.442941> / animSpeed; 
			turn ruparm to z-axis <0.668738> speed <20.062131> / animSpeed; 
			turn ruparm to y-axis <-0.521533> speed <15.646002> / animSpeed; 
			turn torso to y-axis <-8.666667> speed <160.0> / animSpeed; 
		sleep ((33*animSpeed) -1);
		}
		if (isMoving) { //Frame:7
			turn lfoot to x-axis <-40.937818> speed <286.948268> / animSpeed; 
			turn lfoot to z-axis <-11.449800> speed <364.891200> / animSpeed; 
			turn lfoot to y-axis <-14.451830> speed <505.767301> / animSpeed; 
			move lleg to z-axis [-0.640333] speed [36.196471] / animSpeed; 
			move lleg to y-axis [0.780995] speed [39.511263] / animSpeed; 
			turn lthigh to x-axis <16.455381> speed <1472.722862> / animSpeed; 
			turn luparm to x-axis <30.772738> speed <181.704513> / animSpeed; 
			turn luparm to z-axis <0.604493> speed <4.533695> / animSpeed; 
			move pelvis to y-axis [-0.500000] speed [12.0] / animSpeed; 
			turn pelvis to x-axis <2.0> speed <13.341396> / animSpeed; 
			turn pelvis to y-axis <7.0> speed <105.0> / animSpeed; 
			turn rfoot to x-axis <4.588710> speed <239.644705> / animSpeed; 
			turn rfoot to z-axis <0.565360> speed <6.348240> / animSpeed; 
			turn rfoot to y-axis <-6.034509> speed <129.713191> / animSpeed; 
			move rleg to x-axis [-0.105857] speed [3.175723] / animSpeed; 
			move rleg to z-axis [-0.922282] speed [27.668463] / animSpeed; 
			move rleg to y-axis [0.895370] speed [26.861088] / animSpeed; 
			turn rthigh to x-axis <-5.383038> speed <264.524621> / animSpeed; 
			turn ruparm to x-axis <54.999999> speed <19.549333> / animSpeed; 
			turn ruparm to z-axis <-0.0> speed <20.062131> / animSpeed; 
			turn ruparm to y-axis <0.0> speed <15.646002> / animSpeed; 
			turn torso to y-axis <-14.0> speed <159.999982> / animSpeed; 
		sleep ((33*animSpeed) -1);
		}
		if (isMoving) { //Frame:9
			turn lfoot to x-axis <-31.187371> speed <292.513404> / animSpeed; 
			turn lfoot to z-axis <-6.201048> speed <157.462558> / animSpeed; 
			turn lfoot to y-axis <-8.704662> speed <172.415037> / animSpeed; 
			move lleg to z-axis [0.0] speed [19.209976] / animSpeed; 
			move lleg to y-axis [0.0] speed [23.429865] / animSpeed; 
			turn lthigh to x-axis <-11.127814> speed <827.495842> / animSpeed; 
			turn luparm to x-axis <37.919831> speed <214.412786> / animSpeed; 
			turn luparm to z-axis <0.302246> speed <9.067391> / animSpeed; 
			turn luparm to y-axis <-0.155167> speed <4.655000> / animSpeed; 
			move pelvis to y-axis [0.0] speed [15.0] / animSpeed; 
			turn pelvis to x-axis <1.555287> speed <13.341396> / animSpeed; 
			turn pelvis to y-axis <3.500000> speed <105.0> / animSpeed; 
			turn rfoot to x-axis <-17.809763> speed <671.954186> / animSpeed; 
			turn rfoot to z-axis <-0.513051> speed <32.352339> / animSpeed; 
			turn rfoot to y-axis <-1.634483> speed <132.0> / animSpeed; 
			move rleg to x-axis [-0.003880] speed [3.059321] / animSpeed; 
			move rleg to z-axis [-0.146241] speed [23.281236] / animSpeed; 
			move rleg to y-axis [0.265725] speed [18.889351] / animSpeed; 
			turn rthigh to x-axis <15.914020> speed <638.911724> / animSpeed; 
			turn ruparm to x-axis <48.943182> speed <181.704513> / animSpeed; 
			turn ruparm to z-axis <0.151123> speed <4.533695> / animSpeed; 
			turn torso to y-axis <-7.0> speed <210.0> / animSpeed; 
		sleep ((33*animSpeed) -1);
		}
		if (isMoving) { //Frame:11
			turn lfoot to x-axis <6.750937> speed <1138.149238> / animSpeed; 
			turn lfoot to z-axis <0.379494> speed <197.416238> / animSpeed; 
			turn lfoot to y-axis <0.057938> speed <262.877989> / animSpeed; 
			move lleg to z-axis [0.542942] speed [16.288252] / animSpeed; 
			move lleg to y-axis [-0.485064] speed [14.551928] / animSpeed; 
			turn lthigh to x-axis <-28.199824> speed <512.160301> / animSpeed; 
			turn luparm to x-axis <45.066923> speed <214.412786> / animSpeed; 
			turn luparm to z-axis <-0.0> speed <9.067391> / animSpeed; 
			turn luparm to y-axis <0.0> speed <4.655000> / animSpeed; 
			move pelvis to y-axis [0.500000] speed [15.0] / animSpeed; 
			turn pelvis to x-axis <-0.0> speed <46.658604> / animSpeed; 
			turn pelvis to y-axis <0.0> speed <105.0> / animSpeed; 
			turn rfoot to x-axis <-36.246752> speed <553.109675> / animSpeed; 
			turn rfoot to z-axis <-0.033475> speed <14.387283> / animSpeed; 
			turn rfoot to y-axis <-1.104373> speed <15.903306> / animSpeed; 
			move rleg to z-axis [0.948327] speed [32.837049] / animSpeed; 
			move rleg to y-axis [-0.663851] speed [27.887270] / animSpeed; 
			turn rthigh to x-axis <35.827569> speed <597.406491> / animSpeed; 
			turn ruparm to x-axis <42.886368> speed <181.704410> / animSpeed; 
			turn ruparm to z-axis <0.302246> speed <4.533695> / animSpeed; 
			turn torso to y-axis <0.0> speed <210.0> / animSpeed; 
		sleep ((33*animSpeed) -1);
		}
		if (isMoving) { //Frame:13
			turn lfoot to x-axis <13.336446> speed <197.565288> / animSpeed; 
			turn lfoot to z-axis <-0.405751> speed <23.557350> / animSpeed; 
			turn lfoot to y-axis <7.547809> speed <224.696141> / animSpeed; 
			move lleg to z-axis [0.0] speed [16.288252] / animSpeed; 
			move lleg to y-axis [0.0] speed [14.551928] / animSpeed; 
			turn lthigh to x-axis <-14.094029> speed <423.173864> / animSpeed; 
			turn luparm to x-axis <54.348355> speed <278.442941> / animSpeed; 
			turn luparm to z-axis <0.668738> speed <20.062131> / animSpeed; 
			turn luparm to y-axis <-0.521533> speed <15.646002> / animSpeed; 
			move pelvis to y-axis [0.0] speed [15.0] / animSpeed; 
			turn pelvis to x-axis <1.555287> speed <46.658604> / animSpeed; 
			turn pelvis to y-axis <-3.500000> speed <105.0> / animSpeed; 
			turn rfoot to x-axis <-31.380642> speed <145.983307> / animSpeed; 
			turn rfoot to z-axis <-1.336122> speed <39.079413> / animSpeed; 
			turn rfoot to y-axis <-0.789357> speed <9.450482> / animSpeed; 
			move rleg to z-axis [0.566217] speed [11.463327] / animSpeed; 
			move rleg to y-axis [-0.536047] speed [3.834136] / animSpeed; 
			turn rthigh to x-axis <66.152356> speed <909.743597> / animSpeed; 
			turn ruparm to x-axis <36.829555> speed <181.704410> / animSpeed; 
			turn ruparm to z-axis <0.453370> speed <4.533696> / animSpeed; 
			turn torso to y-axis <7.0> speed <210.0> / animSpeed; 
		sleep ((33*animSpeed) -1);
		}
		if (isMoving) { //Frame:15
			turn lfoot to x-axis <4.217904> speed <273.556261> / animSpeed; 
			turn lfoot to z-axis <1.166675> speed <47.172783> / animSpeed; 
			turn lfoot to y-axis <7.793589> speed <7.373403> / animSpeed; 
			move lleg to x-axis [-0.105857] speed [3.175723] / animSpeed; 
			move lleg to z-axis [-0.922282] speed [27.668463] / animSpeed; 
			move lleg to y-axis [0.895370] speed [26.861088] / animSpeed; 
			turn lthigh to x-axis <-5.081794> speed <270.367045> / animSpeed; 
			turn luparm to x-axis <54.999999> speed <19.549333> / animSpeed; 
			turn luparm to z-axis <-0.0> speed <20.062131> / animSpeed; 
			turn luparm to y-axis <0.0> speed <15.646002> / animSpeed; 
			move pelvis to y-axis [-0.500000] speed [15.0] / animSpeed; 
			turn pelvis to x-axis <2.0> speed <13.341396> / animSpeed; 
			turn pelvis to y-axis <-7.0> speed <105.0> / animSpeed; 
			turn rfoot to x-axis <-41.024295> speed <289.309601> / animSpeed; 
			turn rfoot to z-axis <-5.417487> speed <122.440964> / animSpeed; 
			turn rfoot to y-axis <-6.216200> speed <162.805280> / animSpeed; 
			move rleg to z-axis [-0.640333] speed [36.196471] / animSpeed; 
			move rleg to y-axis [0.780995] speed [39.511263] / animSpeed; 
			turn rthigh to x-axis <15.454022> speed <1520.950025> / animSpeed; 
			turn ruparm to x-axis <30.772738> speed <181.704513> / animSpeed; 
			turn ruparm to z-axis <0.604493> speed <4.533695> / animSpeed; 
			turn torso to y-axis <14.0> speed <210.0> / animSpeed; 
		sleep ((33*animSpeed) -1);
		}
		if (isMoving) { //Frame:17
			turn lfoot to x-axis <-18.528584> speed <682.394642> / animSpeed; 
			turn lfoot to y-axis <2.241796> speed <166.553787> / animSpeed; 
			move lleg to x-axis [-0.003880] speed [3.059321] / animSpeed; 
			move lleg to z-axis [-0.146241] speed [23.281236] / animSpeed; 
			move lleg to y-axis [0.265725] speed [18.889351] / animSpeed; 
			turn lthigh to x-axis <15.666938> speed <622.461948> / animSpeed; 
			turn luparm to x-axis <48.943182> speed <181.704513> / animSpeed; 
			turn luparm to z-axis <0.151123> speed <4.533695> / animSpeed; 
			move pelvis to y-axis [-0.100000] speed [12.0] / animSpeed; 
			turn pelvis to x-axis <1.555287> speed <13.341396> / animSpeed; 
			turn pelvis to y-axis <-3.500000> speed <105.0> / animSpeed; 
			turn rfoot to x-axis <-31.564965> speed <283.779914> / animSpeed; 
			turn rfoot to z-axis <-0.870692> speed <136.403870> / animSpeed; 
			turn rfoot to y-axis <-0.066210> speed <184.499692> / animSpeed; 
			move rleg to z-axis [0.0] speed [19.209976] / animSpeed; 
			move rleg to y-axis [0.0] speed [23.429865] / animSpeed; 
			turn rthigh to x-axis <-11.672442> speed <813.793902> / animSpeed; 
			turn ruparm to x-axis <37.919831> speed <214.412786> / animSpeed; 
			turn ruparm to z-axis <0.302246> speed <9.067391> / animSpeed; 
			turn ruparm to y-axis <-0.155167> speed <4.655000> / animSpeed; 
			turn torso to y-axis <5.333334> speed <259.999996> / animSpeed; 
		sleep ((33*animSpeed) -1);
		}
		if (isMoving) { //Frame:19
			turn lfoot to x-axis <-37.751326> speed <576.682280> / animSpeed; 
			turn lfoot to z-axis <-0.037269> speed <33.346009> / animSpeed; 
			turn lfoot to y-axis <-1.118689> speed <100.814540> / animSpeed; 
			move lleg to z-axis [0.948327] speed [32.837049] / animSpeed; 
			move lleg to y-axis [-0.663851] speed [27.887270] / animSpeed; 
			turn lthigh to x-axis <35.365845> speed <590.967228> / animSpeed; 
			turn luparm to x-axis <42.886368> speed <181.704410> / animSpeed; 
			turn luparm to z-axis <0.302246> speed <4.533695> / animSpeed; 
			move pelvis to y-axis [0.300000] speed [12.0] / animSpeed; 
			turn pelvis to x-axis <-0.0> speed <46.658604> / animSpeed; 
			turn pelvis to y-axis <0.0> speed <105.0> / animSpeed; 
			turn rfoot to x-axis <6.399191> speed <1138.924653> / animSpeed; 
			turn rfoot to z-axis <0.378272> speed <37.468905> / animSpeed; 
			turn rfoot to y-axis <0.058748> speed <3.748737> / animSpeed; 
			move rleg to z-axis [0.542942] speed [16.288252] / animSpeed; 
			move rleg to y-axis [-0.485064] speed [14.551928] / animSpeed; 
			turn rthigh to x-axis <-29.161643> speed <524.676042> / animSpeed; 
			turn ruparm to x-axis <45.066923> speed <214.412786> / animSpeed; 
			turn ruparm to z-axis <-0.0> speed <9.067391> / animSpeed; 
			turn ruparm to y-axis <0.0> speed <4.655000> / animSpeed; 
			turn torso to y-axis <-3.333333> speed <260.0> / animSpeed; 
		sleep ((33*animSpeed) -1);
		}
	}
}
// Call this from StopMoving()!
StopWalking() {
	move lleg to x-axis [0.0] speed [1.587861];
	move lleg to y-axis [0.0] speed [19.755632];
	move lleg to z-axis [0.0] speed [18.098236];
	move pelvis to y-axis [0.0] speed [7.500000];
	move rleg to x-axis [0.0] speed [1.587861];
	move rleg to y-axis [0.0] speed [19.755632];
	move rleg to z-axis [0.0] speed [18.098236];
	turn lfoot to x-axis <0.0> speed <569.074619>;
	turn lfoot to y-axis <0.0> speed <252.883651>;
	turn lfoot to z-axis <0.0> speed <182.445600>;
	turn lthigh to x-axis <0.0> speed <736.361431>;
	turn luparm to x-axis <45.066923> speed <139.221470>;
	turn luparm to y-axis <0.0> speed <7.823001>;
	turn luparm to z-axis <0.0> speed <10.031065>;
	turn pelvis to x-axis <0.0> speed <23.329302>;
	turn pelvis to y-axis <0.0> speed <52.500000>;
	turn rfoot to x-axis <0.0> speed <569.462326>;
	turn rfoot to y-axis <0.0> speed <92.249846>;
	turn rfoot to z-axis <0.0> speed <68.201935>;
	turn rthigh to x-axis <0.0> speed <760.475012>;
	turn ruparm to x-axis <45.066923> speed <139.221470>;
	turn ruparm to y-axis <0.0> speed <7.823001>;
	turn ruparm to z-axis <0.0> speed <10.031065>;
	turn torso to y-axis <0.0> speed <130.0>;
}
UnitSpeed(){
 maxSpeed = get MAX_SPEED; // this returns cob units per frame i think
 animFramesPerKeyframe = 2; //we need to calc the frames per keyframe value, from the known animtime
 maxSpeed = maxSpeed + (maxSpeed /(2*animFramesPerKeyframe)); // add fudge
 while(TRUE){
  animSpeed = (get CURRENT_SPEED);
  if (animSpeed<1) animSpeed=1;
  animSpeed = (maxSpeed * 2) / animSpeed; 
  //get PRINT(maxSpeed, animFramesPerKeyframe, animSpeed);
  if (animSpeed<1) animSpeed=1;
  if (animspeed>4) animSpeed = 4;
  sleep 65;
 }
}


#define BASEPIECE pelvis
#define HITSPEED <55.0>
//how 'heavy' the unit is, on a scale of 1-10
#define UNITSIZE 1
#define MAXTILT 100

#include "../unit_hitbyweaponid_and_smoke.h"

Stop()
{
	set INBUILDSTANCE to 0;
}


Create()
{
	hide aimx1;
	hide aimy1;
    hide lnano;
    hide rnano;
    hide armhexl_emit;
    hide armhexl2_emit;
	isMoving = FALSE;
	animSpeed = 3;
	nanoNozzle = 0;
	animSpeed = 60;
	//turn luparm to x-axis <45.010989> speed <45>;
	//turn ruparm to x-axis <45.010989> speed <45>;
}

BuildAnim(){
	set-signal-mask SIGNAL_BUILD;
	while (TRUE){
		turn aimx1 to x-axis <-40> speed <10>;
		wait-for-turn aimx1 around x-axis;
		turn aimx1 to x-axis <-55> speed <10>;
		wait-for-turn aimx1 around x-axis;
	}
}


StartBuilding(heading, pitch)
{
    show lnano;
    show rnano;
	signal SIGNAL_BUILD;
	turn aimy1 to y-axis heading speed <240.0>;
	turn aimx1 to x-axis <-50> - pitch speed <240.0>;
	wait-for-turn aimy1 around y-axis;
	set INBUILDSTANCE to 1;
	show armhexl_emit;
	show armhexl2_emit;
	start-script BuildAnim();	
}

StopBuilding()
{
    hide lnano;
    hide rnano;
	signal SIGNAL_BUILD;	
	set-signal-mask SIGNAL_BUILD;
	hide armhexl_emit;
	hide armhexl2_emit;
	turn aimy1 to y-axis <0.0> speed <160.0>;
	turn aimx1 to x-axis <0> speed <240.0>;
	turn aimy1 to x-axis <0> speed <5>;	
}

StartMoving(reversing)
{
  	signal SIGNAL_MOVE;
  	set-signal-mask SIGNAL_MOVE;
	isMoving = TRUE;
	start-script UnitSpeed();
	start-script walk();

}

StopMoving()
{
	signal SIGNAL_MOVE;
	isMoving = FALSE;
	call-script StopWalking();	
}



QueryNanoPiece(pieceIndex)
{
	pieceIndex = rnano + nanoNozzle;
	nanoNozzle = !nanoNozzle;
}

Killed(severity, corpsetype)
{
	if( severity <= 25 )
	{
		corpsetype = 1 ;
		explode pelvis type BITMAPONLY | NOHEATCLOUD;
		explode torso type BITMAPONLY | NOHEATCLOUD;
		
		explode lnano type FIRE | SMOKE | FALL | NOHEATCLOUD;
		explode ruparm type BITMAPONLY | NOHEATCLOUD;
		
		
		
		
		
		
		
		return(corpsetype);
	}
	if( severity <= 50 )
	{
		corpsetype = 2 ;
		explode pelvis type FIRE | SMOKE | FALL | NOHEATCLOUD;
		explode torso type FIRE | SMOKE | FALL | NOHEATCLOUD;
		
		explode lnano type FIRE | SMOKE | FALL | NOHEATCLOUD;
		explode ruparm type FIRE | SMOKE | FALL | NOHEATCLOUD;
		explode rnano type FALL | NOHEATCLOUD;
		
		
		
		
		
		
		return(corpsetype);
	}
	if( severity <= 99 )
	{
		corpsetype = 3 ;
		explode pelvis type FIRE | SMOKE | FALL | NOHEATCLOUD;
		explode torso type EXPLODE_ON_HIT | FIRE | SMOKE | FALL | NOHEATCLOUD;
		explode luparm type EXPLODE_ON_HIT | SMOKE | FALL | NOHEATCLOUD;
		explode lnano type EXPLODE_ON_HIT | FIRE | SMOKE | FALL | NOHEATCLOUD;
		explode ruparm type EXPLODE_ON_HIT | SMOKE | FALL | NOHEATCLOUD;
		
		
		
		
		
		
		
		return(corpsetype);
	}
	corpsetype = 3 ;
		explode pelvis type EXPLODE_ON_HIT | FIRE | SMOKE | FALL | NOHEATCLOUD;
		explode torso type EXPLODE_ON_HIT | FIRE | FALL | NOHEATCLOUD;
		explode luparm type EXPLODE_ON_HIT | FIRE | FALL | NOHEATCLOUD;
		explode lnano type EXPLODE_ON_HIT | FIRE | SMOKE | FALL | NOHEATCLOUD;
		explode ruparm type EXPLODE_ON_HIT | FIRE | SMOKE | FALL | NOHEATCLOUD;
		
		
		
		
		
		
		
	return corpsetype;
}
