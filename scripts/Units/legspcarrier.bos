
#include "../recoil_common_includes.h"

piece
    pad2,
    chassis,
    turbineContainer4,
    turbineContainer2,
    turbineContainer3,
    turbineContainer1,
    base,
    thruster2B,
    thruster2A,
    thruster1B,
    thruster1A,
    thruster1C,
    barrelSpinPivot1,
    flareR1,
    flareR2,
    flareR3,
    barrelSpinPivot2,
    flareL1,
    flareL2,
    flareL3,
    thrusterPivot1,
    thrusterPivot2,
    padFlare1,
    padFlare2,
    thrust1a,
    thrust1b,
    thrust1c,
    thrust2a,
    thrust2b,
    turbine1,
    turbine2,
    turbine3,
    turbine4;

static-var  restore_delay, whichBarrel, whichPod;

// Signal definitions
#define SIGNAL_AIM1 256
#define SIGNAL_AIM2 512
#define SIGNAL_MOVE1 1024

#define BASEPIECE base
#define HITSPEED <55.0>
//how 'heavy' the unit is, on a scale of 1-10
#define UNITSIZE 5
#define MAXTILT 100

#define IDLEHOVERSCALE 32
#define IDLEHOVERSPEED 60
#define IDLEBASEPIECE base

static-var isMoving;

Create()
{
    turn thrusterPivot1 to y-axis <38> now;
    turn thrusterPivot2 to y-axis <38> now;

    turn thrust1a to x-axis <-90> now;
    turn thrust1b to x-axis <-90> now;
    turn thrust1c to x-axis <-90> now;
    turn thrust2a to x-axis <-90> now;
    turn thrust2b to x-axis <-90> now;

    hide thrust1a;
    hide thrust1b;
    hide thrust1c;
    hide thrust2a;
    hide thrust2b;

    isMoving = 0;

	SLEEP_UNTIL_UNITFINISHED;
}

Activate()
{
    show thrust1a;
    show thrust1b;
    show thrust1c;
    show thrust2a;
    show thrust2b;

    isMoving = 1;
}

Deactivate()
{
    hide thrust1a;
    hide thrust1b;
    hide thrust1c;
    hide thrust2a;
    hide thrust2b;
    isMoving = 0;
    // signal SIGNAL_MOVE1;
    turn turbineContainer1 to x-axis <0> speed <150>;
    turn turbineContainer2 to x-axis <0> speed <150>;
    turn turbineContainer3 to x-axis <0> speed <150>;
    turn turbineContainer4 to x-axis <0> speed <150>;
    stop-spin turbine1 around y-axis decelerate <5>;
    stop-spin turbine2 around y-axis decelerate <5>;
    stop-spin turbine3 around y-axis decelerate <5>;
    stop-spin turbine4 around y-axis decelerate <5>;
}

SetMaxReloadTime(reloadMS)
{
	restore_delay = reloadMS * 2;
}

static-var  Stunned;
ExecuteRestoreAfterDelay()
{
    if (Stunned) {
        return (1);
    }
}

SetStunned(State)
{
    Stunned = State;
	if (!Stunned) {
	    start-script ExecuteRestoreAfterDelay();
	}
}

RestoreAfterDelay()
{
	sleep restore_delay;
	start-script ExecuteRestoreAfterDelay();
}

StartMoving(reversing)
{
	
}

StopMoving()
{	
	
}

MoveRate3()
{
    if(isMoving == 1){
        turn turbineContainer1 to x-axis <45> speed <45>;
        turn turbineContainer2 to x-axis <45> speed <45>;
        turn turbineContainer3 to x-axis <45> speed <45>;
        turn turbineContainer4 to x-axis <45> speed <45>;

        spin turbine1 around y-axis speed <900> accelerate <9>;
        spin turbine2 around y-axis speed <900> accelerate <9>;
        spin turbine3 around y-axis speed <900> accelerate <9>;
        spin turbine4 around y-axis speed <900> accelerate <9>;
    }
}

MoveRate2()
{
    if(isMoving == 1){
        turn turbineContainer1 to x-axis <45> speed <60>;
        turn turbineContainer2 to x-axis <45> speed <60>;
        turn turbineContainer3 to x-axis <45> speed <60>;
        turn turbineContainer4 to x-axis <45> speed <60>;

        spin turbine1 around y-axis speed <600> accelerate <6>;
        spin turbine2 around y-axis speed <600> accelerate <6>;
        spin turbine3 around y-axis speed <600> accelerate <6>;
        spin turbine4 around y-axis speed <600> accelerate <6>;
    }
}

MoveRate1()
{
    if(isMoving == 1){
        turn turbineContainer1 to x-axis <15> speed <90>;
        turn turbineContainer2 to x-axis <15> speed <90>;
        turn turbineContainer3 to x-axis <15> speed <90>;
        turn turbineContainer4 to x-axis <15> speed <90>;

        spin turbine1 around y-axis speed <300> accelerate <3>;
        spin turbine2 around y-axis speed <300> accelerate <3>;
        spin turbine3 around y-axis speed <300> accelerate <3>;
        spin turbine4 around y-axis speed <300> accelerate <3>;
    }



}

MoveRate0()
{
    if(isMoving == 1){
        turn turbineContainer1 to x-axis <0> speed <150>;
        turn turbineContainer2 to x-axis <0> speed <150>;
        turn turbineContainer3 to x-axis <0> speed <150>;
        turn turbineContainer4 to x-axis <0> speed <150>;


        spin turbine1 around y-axis speed <200> accelerate <2>;
        spin turbine2 around y-axis speed <200> accelerate <2>;
        spin turbine3 around y-axis speed <200> accelerate <2>;
        spin turbine4 around y-axis speed <200> accelerate <2>;
    }
}

// Drone Control Matrix

AimFromWeapon1(pieceIndex)
{
	pieceIndex = base;
}

AimWeapon1(heading, pitch)
{
	signal SIGNAL_AIM1;
	set-signal-mask SIGNAL_AIM1;
	
	return (0);
}

FireWeapon1()
{

}

QueryWeapon1(pieceIndex)
{

}

// AA Missiles

AimFromWeapon2(pieceIndex)
{
	pieceIndex = barrelSpinPivot1;
}

AimWeapon2(heading, pitch)
{
	signal SIGNAL_AIM2;
	set-signal-mask SIGNAL_AIM2;
    
	return (1);
}

FireWeapon2()
{

}

Shot2(zero){
	if (whichBarrel == 0){
        spin barrelSpinPivot1 around z-axis speed <900>;
        if (whichPod == 0){
            emit-sfx 1024 + 0 from flareR1;
            sleep 1;
            whichPod = 1;
        }
        else if (whichPod == 1){
            emit-sfx 1024 + 0 from flareR2;
            sleep 1;
            whichPod = 2;
        }
        else if (whichPod == 2){
            emit-sfx 1024 + 0 from flareR3;
            sleep 1;
            whichPod = 0;
            whichBarrel = 1;
        }
        stop-spin barrelSpinPivot1 around z-axis decelerate <10>;
    }
	else if (whichBarrel == 1){
        spin barrelSpinPivot2 around z-axis speed <900>;
        if (whichPod == 0){
            emit-sfx 1024 + 0 from flareL1;
            sleep 1;
            whichPod = 1;
        }
        else if (whichPod == 1){
            emit-sfx 1024 + 0 from flareL2;
            sleep 1;
            whichPod = 2;
        }
        else if (whichPod == 2){
            emit-sfx 1024 + 0 from flareL3;
            sleep 1;
            whichPod = 0;
            whichBarrel = 0;
        }
        stop-spin barrelSpinPivot2 around z-axis decelerate <10>;
    }
    else{
        whichBarrel = 0;
        whichPod = 0;
    }   
}

QueryWeapon2(pieceIndex)
{
	if (whichBarrel == 0){
        if (whichPod == 0){
            pieceIndex = flareR1;
        }
        else if (whichPod == 1){
            pieceIndex = flareR2;
        }
        else if (whichPod == 2){
            pieceIndex = flareR3;
        }
    }
	else if (whichBarrel == 1){
        if (whichPod == 0){
            pieceIndex = flareL1;
        }
        else if (whichPod == 1){
            pieceIndex = flareL2;
        }
        else if (whichPod == 2){
            pieceIndex = flareL3;
        }
    }
}

Killed(severity, corpsetype)
{
	if( severity <= 25 )
	{
		corpsetype = 1 ;
		explode base type BITMAPONLY | NOHEATCLOUD;
		// explode armor type BITMAPONLY | NOHEATCLOUD;
		// explode leftplasmasleeve type BITMAPONLY | NOHEATCLOUD;
		// explode leftplasmabarrel1 type FIRE | SMOKE | FALL | NOHEATCLOUD;
		return(corpsetype);
	}
	if( severity <= 50 )
	{
		corpsetype = 2 ;
		explode base type BITMAPONLY | NOHEATCLOUD;
		// explode armor type BITMAPONLY | NOHEATCLOUD;
		// explode leftplasmasleeve type FIRE | SMOKE | FALL | NOHEATCLOUD;
		// explode leftplasmabarrel1 type FALL | NOHEATCLOUD;
		return(corpsetype);
	}
	if( severity <= 99 )
	{
		corpsetype = 3 ;
		explode base type BITMAPONLY | NOHEATCLOUD;
		// explode armor type BITMAPONLY | NOHEATCLOUD;
		// explode leftplasmasleeve type FIRE | SMOKE | FALL | NOHEATCLOUD;
		// explode leftplasmabarrel1 type SMOKE | FALL | NOHEATCLOUD;
		return(corpsetype);
	}
	corpsetype = 3 ;
		explode base type BITMAPONLY | NOHEATCLOUD;
		// explode armor type BITMAPONLY | NOHEATCLOUD;
		// explode leftplasmasleeve type EXPLODE_ON_HIT | FIRE | SMOKE | FALL | NOHEATCLOUD;
		// explode leftplasmabarrel1 type EXPLODE_ON_HIT | FIRE | FALL | NOHEATCLOUD;
	return(corpsetype);
}
